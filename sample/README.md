# 蓄水池抽樣算法

## 問題描述
    
    給出一個數據流，這個數據流的長度很大或者未知，並且對
該數據流只能訪問一次。請寫出一個隨機選擇算法，使得數據流
中所有的數據被選中的概率相等。

### 問題分析

#### 特殊情況：假設需要選擇1個數據

* 數據流僅含一個數據，直接返回該數據，概率為1
* 數據流含兩個數據，等概率返回兩個數據之一。
  讀第一個數據，暫時保留它；
  讀第二個數據時，以1/2的概率保留並替代第一個數據，則：

  第二個數據被留下的概率是 1/2
  第一個數據被留下的概率是 1*(1-1/2) = 1/2

* 數據流含三個數據，
  讀第一個數據，暫時保留它；
  讀第二個數據，以1/2的概率保留並替代第一個數據；
  讀第三個數據，以1/3的概率保留並替代前兩次操作剩下的數據，則：

  第三個數據被留下的概率是 1/3
  第二個數據被留下的概率是 1/2 * (1-1/3) = 1/3
  第一個數據被留下的概率是 1/2 * (1-1/3) = 1/3

* 推廣到N個數據， 
  假設N-1時，該推論成立，即：前N-1個數據被留下的概率都是1/(N-1)
  讀到第N個數據，以1/N的概率保留並替代前N-1次操作剩下的數據，則

  第N個數據被留下的概率是 1/N
  前N-1個數據被留下的概率是 1/(N-1) * (1-1/N) = 1/N

#### 一般情況：假設需要選擇K個數據

* 數據流包含N個數據，且N小於等於K，直接保留所有數據，概率為1

* 數據流包含K+1個數據，
  讀前K個數據，直接保留；
  讀第K+1個數據，以K/(K+1)的概率保留並等概率替換前K個數據之一，則：

  第K+1個數據被留下的概率是 K/(K+1)
  第K個數據被留下的概率是： (1- K/(K+1)) + K/(K+1) * (1-1/K) = K/(K+1)
                           
       A:    K+1 扔掉
       B(i): K+1 留下且第i個數被等概率替換
       C:    K 留下
       P(C) = P(A) + {P(B(i))} [0 < i < K]

* 數據流含N個數據，
  讀到第N個數據，以K/N的概率保留並替代前N-1次操作剩下的數據之一(等概率)
